const azdev = require('azure-devops-node-api');

const orgUrl = 'https://dev.azure.com/YOUR_ORG_NAME';
const pat = 'YOUR_PERSONAL_ACCESS_TOKEN';
const project = 'YOUR_PROJECT_NAME';
const workItemType = 'CustomTaskType'; // Replace with your custom work item type name
const parentWorkItemId = 123; // Replace with the ID of the parent work item

async function createWorkItemWithSdk() {
  try {
    const authHandler = azdev.getPersonalAccessTokenHandler(pat);
    const connection = new azdev.WebApi(orgUrl, authHandler);

    const workItemTrackingApi = await connection.getWorkItemTrackingApi();

    // Create a new work item
    const newWorkItem = [
      {
        op: 'add',
        path: '/fields/System.Title',
        value: 'New Custom Task'
      }
      // Add more fields as needed
    ];
    const createdWorkItem = await workItemTrackingApi.createWorkItem(null, newWorkItem, project, workItemType);

    // Link as a child to another work item
    const link = {
      rel: 'System.LinkTypes.Hierarchy-Reverse',
      url: createdWorkItem.url
    };
    await workItemTrackingApi.createWorkItemRelation(link, project, parentWorkItemId);

    console.log('Work item created and linked successfully.');
  } catch (error) {
    console.error('Error:', error.message);
  }
}

createWorkItemWithSdk();
