const azdev = require('azure-devops-node-api');

// Replace with your Azure DevOps organization URL and PAT token
const orgUrl = 'https://dev.azure.com/YourOrganization';
const patToken = 'YourPersonalAccessToken';

const projectId = 'YourProjectId'; // Replace with your project ID
const workItemId = 123; // Replace with the ID of the work item you want to update

const attachmentFileNameToDelete = 'example.txt'; // Replace with the file name of the attachment to delete

async function deleteAttachment() {
  try {
    // Connect to Azure DevOps
    const connection = new azdev.WebApi(orgUrl, azdev.getPersonalAccessTokenHandler(patToken));
    const workItemTrackingApi = await connection.getWorkItemTrackingApi();

    // Get the work item
    const workItem = await workItemTrackingApi.getWorkItem(workItemId, [], projectId);

    // Find the index of the attachment by comparing the file name
    const attachmentIndexToDelete = workItem.relations.findIndex((relation) =>
      relation.attributes && relation.attributes.name === attachmentFileNameToDelete
    );

    if (attachmentIndexToDelete !== -1) {
      // Remove the attachment from the "relations" collection
      workItem.relations.splice(attachmentIndexToDelete, 1);

      // Update the work item to save the changes
      await workItemTrackingApi.updateWorkItems([workItem], projectId);
      console.log(`Attachment "${attachmentFileNameToDelete}" deleted successfully.`);
    } else {
      console.error(`Attachment "${attachmentFileNameToDelete}" not found.`);
    }
  } catch (error) {
    console.error('Error:', error);
  }
}

deleteAttachment();
